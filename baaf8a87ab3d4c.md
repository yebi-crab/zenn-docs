---
title: "YouTube Data APIã‚’åˆ©ç”¨ã—ã¦ã€å‹•ç”»ã‚¿ã‚¤ãƒˆãƒ«ã¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’åé›†ã™ã‚‹"
emoji: "ğŸ’¬"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Python","YouTube"]
published: true
---

## YouTube Data APIã«ã¤ã„ã¦
### æ¦‚è¦
ã€ŒYouTube Data API v3ã€ã‚’åˆ©ç”¨ã€‚Google Cloudã§æä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚
ç„¡æ–™ã§åˆ©ç”¨å¯èƒ½ã§ã™ãŒã€1æ—¥10000ã‚¯ã‚©ãƒ¼ã‚¿ã®åˆ©ç”¨åˆ¶é™ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã®ã€Œ10000ã‚¯ã‚©ãƒ¼ã‚¿ã€ã¯ã€ã©ã®ã‚ˆã†ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¡Œã†ã‹ã«ã‚ˆã£ã¦è¨ˆç®—ã•ã‚Œã‚‹ã‚ˆã†ã§ã™ã€‚ãªãŠã€ä»Šå›ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆ50ä»¶ã®å‹•ç”»ã§ãã‚Œãã‚Œ300ã‚³ãƒ¡ãƒ³ãƒˆå–å¾—ï¼‰ã‚’æ•°å›å®Ÿè¡Œã—ã¦ã‚‚ã€1000ã‚¯ã‚©ãƒ¼ã‚¿ã‚‚æ¶ˆè²»ã—ã¦ã„ãªã„ç¨‹åº¦ã§ã™ã€‚å‹•ç”»ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãªã©ã§æ¶ˆè²»ãŒå¤šã„ã‚ˆã†ã§ã™ã€‚
https://developers.google.com/youtube/v3/determine_quota_cost?hl=ja
https://apidog.com/jp/blog/youtube-data-api/

### åˆ©ç”¨æ–¹æ³•
åˆ©ç”¨ã™ã‚‹ã«ã‚ãŸã£ã¦ã¯ã€Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç™»éŒ²ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ç´ã¥ã‘ã‚‹å½¢ã§APIã‚’æœ‰åŠ¹åŒ–ã—ã¾ã™ã€‚ï¼ˆä»–ã®APIã‚‚åŒæ§˜ï¼‰
APIã‚­ãƒ¼ã‚’æ‰•ã„å‡ºã—ã€åˆ©ç”¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚APIã‚­ãƒ¼ã¯æ‚ªç”¨ã•ã‚Œãªã„ã‚ˆã†ã€ç®¡ç†ã«ã¯æ³¨æ„ã—ã¾ã—ã‚‡ã†ã€‚
https://qiita.com/kaburankattara/items/240a457f79ade800a4fb

## ç’°å¢ƒ
Google Colaboratoryã‚’åˆ©ç”¨ã€‚

## ä½¿ã£ã¦ã¿ã‚‹
ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã¯ä»¥ä¸‹ã§ã™ã€‚
https://developers.google.com/youtube/v3/docs?hl=ja

ä»¥ä¸‹ã®æ¡ä»¶ã§å‹•ç”»ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã€‚
- ç‰¹å®šã®ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚’æŒ‡å®š
- æœ€æ–°50ä»¶ã®å‹•ç”»ã®æƒ…å ±ã‚’å–å¾—ï¼ˆâ€»ï¼‰
- å„å‹•ç”»ã€Œå‹•ç”»IDã€ã€Œã‚¿ã‚¤ãƒˆãƒ«ã€ã€ŒæŠ•ç¨¿æ—¥æ™‚ã€ã€Œã‚³ãƒ¡ãƒ³ãƒˆã€ã‚’å–å¾—
- ã‚³ãƒ¡ãƒ³ãƒˆã¯æœ€æ–°300ä»¶ã‚’å–å¾—
- å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã¯CSVå½¢å¼ã§ä¿å­˜ã™ã‚‹

â€»å‹•ç”»ã®å–å¾—ä¸Šé™ã«ã¤ã„ã¦
YouTube Data APIã§ã¯ã€ä¸€åº¦ã®æ¤œç´¢ã§å–å¾—ã§ãã‚‹ä»¶æ•°ãŒæœ€å¤§50ä»¶ã¨ã®ã“ã¨ã§ã™
https://zenn.dev/jqinglong/articles/1161615fdaa6f6

ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã€‚

### å‹•ç”»æƒ…å ±ã®å–å¾—
```py
#ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
from googleapiclient.discovery import build
from datetime import datetime

# APIã‚­ãƒ¼ã‚’è¨­å®š
API_KEY = 'YOUR_API_KEY' #å–å¾—ã—ãŸAPIã‚­ãƒ¼ã‚’ã‚³ãƒ”ãƒšã™ã‚‹

# YouTubeãƒ‡ãƒ¼ã‚¿APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆ
youtube = build('youtube', 'v3', developerKey=API_KEY)

# ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆID
PLAYLIST_ID = 'PLAYLIST_ID' #å¯¾è±¡ã®ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã®IDã‚’ã‚³ãƒ”ãƒš

# å‹•ç”»æƒ…å ±ã‚’æ ¼ç´ã™ã‚‹ãƒªã‚¹ãƒˆ
video_data = []

# ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå†…ã®å‹•ç”»ã‚’å–å¾—
playlist_response = youtube.playlistItems().list(
    playlistId=PLAYLIST_ID,
    part='snippet',
    maxResults=50  # æœ€å¤§å–å¾—ä»¶æ•°ï¼ˆYouTube APIã®åˆ¶é™ï¼‰
).execute()

# å‹•ç”»ã®æƒ…å ±ã‚’å–å¾—ã—ã€ãƒªã‚¹ãƒˆã«è¿½åŠ 
for playlist_item in playlist_response.get('items', []):
    video_id = playlist_item['snippet']['resourceId']['videoId']
    video_title = playlist_item['snippet']['title']
    video_published_at = playlist_item['snippet']['publishedAt']

    # å‹•ç”»ã®è©³ç´°æƒ…å ±ã‚’å–å¾—
    video_response = youtube.videos().list(
        id=video_id,
        part='snippet,statistics'
    ).execute()

    # å‹•ç”»ã®æŠ•ç¨¿æ—¥æ™‚
    published_at = datetime.strptime(video_published_at, '%Y-%m-%dT%H:%M:%SZ')

    # æœ€æ–°300ä»¶ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—
    comment_threads = youtube.commentThreads().list(
        videoId=video_id,
        part='snippet',
        maxResults=300,
        textFormat='plainText'
    ).execute()

    comments = [comment['snippet']['topLevelComment']['snippet']['textDisplay']
                for comment in comment_threads.get('items', [])]

    # å‹•ç”»æƒ…å ±ã‚’ãƒªã‚¹ãƒˆã«è¿½åŠ 
    video_data.append({
        'video_id': video_id,
        'title': video_title,
        'published_at': published_at,
        'comments': '\n'.join(comments)
    })
```

### CSVå½¢å¼ã§ä¿å­˜
å–å¾—ã—ãŸå‹•ç”»ã®ãƒ‡ãƒ¼ã‚¿ã‚’CSVå½¢å¼ã§ä¿å­˜ã€‚
ä»Šå›ã¯Google Colaboratoryã«Google Driveã‚’ãƒã‚¦ãƒ³ãƒˆã—ã€ãƒ‰ãƒ©ã‚¤ãƒ–å†…ã«ä¿å­˜ã—ã¦ã„ã¾ã™ã€‚
```py
# ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import csv

#Google Colabã«Googleãƒ‰ãƒ©ã‚¤ãƒ–ã‚’ãƒã‚¦ãƒ³ãƒˆï¼ˆå¿…è¦ãªå ´åˆã®ã¿ï¼‰
from google.colab import drive
drive.mount('/content/drive')

# CSVãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
with open('YOUR_FILE_PATH', 'w', newline='', encoding='utf-8') as csvfile: #ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’ã‚³ãƒ”ãƒš
    fieldnames = ['video_id', 'title', 'published_at', 'comments']
    writer = csv.DictWriter(csvfile, fieldnames=fieldnames)

    writer.writeheader()
    for video in video_data:
        writer.writerow({
            'video_id': video['video_id'],
            'title': video['title'],
            'published_at': video['published_at'].isoformat(),
            'comments': video['comments']
        })
```

## ãŠã‚ã‚Šã«
noteã«æ²è¼‰ã—ãŸã“ã¡ã‚‰ã®å–ã‚Šçµ„ã¿ã®ä¸­ã§YouTube Data APIã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚
ã”èˆˆå‘³ã®ã‚ã‚‹æ–¹ã¯ã“ã¡ã‚‰ã‚‚ã”è¦§ãã ã•ã„ã€‚
https://note.com/yebi_crab/n/n4866e35703cd
